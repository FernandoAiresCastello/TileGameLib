
# This line is a comment

:start
	CALL init_window
	CALL test_maprender
	CALL test_objmanip
	SYSTEM.HALT

:exit
	SYSTEM.EXIT
	
:test_objmanip
	PUSH 0
	PUSH 0
	PUSH 0
	MAP.CURSOR.SET
	PUSH 0
	PUSH 0
	PUSH 0
	OBJ.ANY
	POP
	PUSH 0
	PUSH 1
	PUSH 1
	OBJ.ANY
	POP
	PUSH 0
	PUSH 1
	PUSH 1
	OBJ.CREATE
	PUSH 0
	PUSH 1
	PUSH 1
	OBJ.ANY
	POP
	PUSH 0
	PUSH 15
	PUSH 12
	PUSH 0
	PUSH 3
	OBJ.TILE.IX.SET
	PUSH 0
	PUSH 15
	PUSH 12
	PUSH 0
	PUSH 4
	OBJ.TILE.FG.SET
	PUSH 0
	PUSH 15
	PUSH 12
	PUSH 0
	PUSH 6
	OBJ.TILE.BG.SET

	PUSH 0
	PUSH 15
	PUSH 12
	PUSH 0
	PUSH 16
	PUSH 12
	OBJ.MOVE

	PUSH 0
	PUSH 16
	PUSH 12
	PUSH 0
	PUSH 16
	PUSH 13
	OBJ.COPY

	PUSH 0
	PUSH 16
	PUSH 13
	OBJ.DELETE

	PUSH 0
	PUSH 18
	PUSH 11
	PUSH 0
	PUSH 16
	PUSH 12
	OBJ.SWAP

	PUSH 0
	PUSH 16
	PUSH 12
	OBJ.DELETE

	PUSH TestObject
	PUSH 0
	PUSH 15
	PUSH 12
	OBJ.AT
	POP
	PUSH Dummy
	PUSH 0
	PUSH 15
	PUSH 12
	OBJ.AT
	POP
	PUSH TestObject
	DUP
	OBJ.EXISTS
	POP
	OBJ.FIND
	POP
	POP
	POP
	PUSH FooBar
	OBJ.EXISTS
	POP
	RET

:init_window
	PUSH 40
	PUSH 30
	WINDOW.OPEN
	RET

:test_window
	PUSH 1
	WINDOW.BG.SET
	WINDOW.CLEAR
	WINDOW.REFRESH
	PUSH 1
	DUP
	WINDOW.TILE.X.SET
	WINDOW.TILE.Y.SET
	PUSH 64
	WINDOW.TILE.FG.SET
	PUSH 1
	WINDOW.TILE.BG.SET
	RET
	PUSH 3
	WINDOW.TILE.PUT
	WINDOW.REFRESH
	RET

:test_maprender
	PUSH 1
	MAPVIEW.X.SET
	PUSH 3
	MAPVIEW.Y.SET
	PUSH 32
	MAPVIEW.WIDTH.SET
	PUSH 24
	MAPVIEW.HEIGHT.SET
	PUSH ../../../Test/test.tgmap
	MAP.LOAD

	RET

	MAP.NAME.GET
	WINDOW.PRINT
	PUSH 1
	MAP.BG.SET
	PUSH 1
	PUSH 0xff0000
	MAP.PALETTE.SET
	MAP.HIDE
	MAP.SHOW
	PUSH 1
	DUP
	MAPVIEW.SCROLL.X.SET
	MAPVIEW.SCROLL.Y.SET
	PUSH 0
	DUP
	MAPVIEW.SCROLL.Y.SET
	MAPVIEW.SCROLL.X.SET
	PUSH 8
	PUSH 0b10000001
	PUSH 0b01000010
	PUSH 0b00100100
	PUSH 0b00011000
	PUSH 0b00011000
	PUSH 0b00100100
	PUSH 0b01000010
	PUSH 0b10000001
	MAP.TILESET.SET
	RET

:test_key_input
	PUSH Space
	WINDOW.KEY.PRESSED
	WINDOW.PRINT
	WINDOW.REFRESH
	PUSH Escape
	WINDOW.KEY.PRESSED
	JZ test_key_input
	RET

:test_logging
	PUSH This is a test log message
	SYSTEM.LOG
	RET

:test_string
	PUSH 255
	PUSH 6,d
	STRING.FORMAT
	POP
	PUSH 12
	PUSH 2,x
	STRING.FORMAT
	POP
	PUSH 12
	PUSH 2,X
	STRING.FORMAT
	POP
	PUSH 15
	PUSH 8,b
	STRING.FORMAT
	POP
	PUSH Left
	PUSH Right
	PUSH 0xff0d
	STRING.JOIN
	POP
	PUSH Hello
	PUSH world!
	PUSH 0x20
	STRING.JOIN
	POP
	RET
	
:test_logical_ops
	# === NOT ===
	PUSH 0b11100011
	NOT
	CONVERT.BYTE
	CALL to_binary
	POP
	PUSH 0
	NOT
	POP
	PUSH 1
	NOT
	POP
	# === XOR ===
	PUSH 1
	PUSH 1
	XOR
	POP
	PUSH 0
	PUSH 0
	XOR
	POP
	PUSH 1
	PUSH 0
	XOR
	POP
	PUSH 0b11100011
	PUSH 0b11001001
	XOR
	CALL to_binary
	POP
	# === OR ===
	PUSH 1
	PUSH 1
	OR
	POP
	PUSH 0
	PUSH 0
	OR
	POP
	PUSH 1
	PUSH 0
	OR
	POP
	PUSH 0b11100011
	PUSH 0b11001001
	OR
	CALL to_binary
	POP
	# === AND ===
	PUSH 1
	PUSH 1
	AND
	POP
	PUSH 0
	PUSH 1
	AND
	POP
	PUSH 0
	PUSH 0
	AND
	POP
	PUSH 0b11100011
	PUSH 0b11001001
	AND
	CALL to_binary
	POP
	RET

:to_binary
	PUSH 8,b
	STRING.FORMAT
	RET

:test_random
	PUSH 5
	PUSH 6
	MATH.RANDOM
	PUSH 10
	PUSH 20
	MATH.RANDOM
	RET

:test_math
	PUSH 22
	PUSH 3
	MATH.POW
	POP
	PUSH 44
	MATH.SQRT
	POP
	PUSH 1
	MATH.INC
	MATH.DEC
	POP
	PUSH 50
	PUSH 20
	MATH.ADD
	POP
	PUSH 30
	PUSH 10
	MATH.SUB
	POP
	PUSH 10
	PUSH 5
	MATH.MUL
	POP
	PUSH 30
	PUSH 2
	MATH.DIV
	POP
	PUSH 100
	PUSH 88
	MATH.MOD
	POP
	RET


:main
	CALL init_vars
	CALL init_window
	PUSH level01
	STORE $current_map
	CALL load_current_map

:init_vars
	PUSH 0
	STORE $score
	RET
	
:game_loop
	CALL process_input
	JMP game_loop
	
:process_input
	PUSH Right
	WINDOW.KEY.PRESSED
	CLNZ player_try_move_right
	PUSH Left
	WINDOW.KEY.PRESSED
	CLNZ player_try_move_left
	PUSH Up
	WINDOW.KEY.PRESSED
	CLNZ player_try_move_up
	PUSH Down
	WINDOW.KEY.PRESSED
	CLNZ player_try_move_down
	RET
	
:player_try_move_right
	PUSH Player
	OBJ.FIND_BY_TAG
	OBJ.FIND_RIGHT
	OBJ.TAG.GET
	PUSH Wall
	STRING.EQUAL
	CLZ player_move_right
	RET
:player_move_right
	PUSH Player
	OBJ.FIND_BY_TAG
	# OBJ.FIND_RIGHT
	OBJ.TAG.GET
	PUSH Food
	STRING.EQUAL
	CLNZ player_eat_food
	PUSH Player
	OBJ.FIND_BY_TAG
	OBJ.MOVE_RIGHT
	RET

:player_try_move_left
	RET

:player_try_move_up
	RET

:player_try_move_down
	RET
	
:player_eat_food
	LOAD $score
	MATH.INC
	STORE $score
	RET
	
:load_current_map
	LOAD $current_map
	PUSH .tgmap
	STRING.CONCAT
	MAP.LOAD
	RET
	
:init_window
	PUSH 30
	PUSH 24
	WINDOW.OPEN
	PUSH 0
	MAPVIEW.X.SET
	PUSH 0
	MAPVIEW.Y.SET
	PUSH 30
	MAPVIEW.WIDTH.SET
	PUSH 24
	MAPVIEW.HEIGHT.SET
	RET
